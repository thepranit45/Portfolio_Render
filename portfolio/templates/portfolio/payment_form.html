{% extends 'portfolio/base.html' %}
{% load static %}
{% block title %}Payment Details ‚Äî {{ service.name }}{% endblock %}

{% block content %}
<section class="min-h-screen py-20 pt-32 bg-dark/50">
  <div class="container mx-auto px-6">
    
    <!-- Progress Indicator -->
    <div class="max-w-4xl mx-auto mb-8">
      <div class="flex items-center justify-center gap-4 text-sm">
        <div class="flex items-center gap-2 text-primary">
          <span class="bg-primary text-dark rounded-full w-8 h-8 flex items-center justify-center font-bold">1</span>
          <span class="font-semibold">Details</span>
        </div>
        <div class="h-0.5 bg-gray-700 w-12"></div>
        <div class="flex items-center gap-2 text-gray-500">
          <span class="border-2 border-gray-700 text-gray-500 rounded-full w-8 h-8 flex items-center justify-center">2</span>
          <span>Payment</span>
        </div>
        <div class="h-0.5 bg-gray-700 w-12"></div>
        <div class="flex items-center gap-2 text-gray-500">
          <span class="border-2 border-gray-700 text-gray-500 rounded-full w-8 h-8 flex items-center justify-center">3</span>
          <span>Confirmation</span>
        </div>
      </div>
    </div>

    <div class="max-w-4xl mx-auto">
      
      <div class="grid lg:grid-cols-2 gap-8">
        
        <!-- Service Summary -->
        <div class="glass p-8 rounded-2xl subtle-glow">
          <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
            <span>üìã</span> Order Summary
          </h2>
          
          <div class="space-y-6">
            <div class="border border-gray-700 rounded-lg p-6">
              <div class="flex items-start gap-4">
                {% if service.service_type == 'consultation' %}
                  <div class="text-4xl">ü§ù</div>
                {% elif service.service_type == 'development' %}
                  <div class="text-4xl">üíª</div>
                {% elif service.service_type == 'maintenance' %}
                  <div class="text-4xl">üîß</div>
                {% elif service.service_type == 'training' %}
                  <div class="text-4xl">üéì</div>
                {% else %}
                  <div class="text-4xl">‚≠ê</div>
                {% endif %}
                
                <div class="flex-1">
                  <h4 class="font-bold text-lg text-white mb-2">{{ service.name }}</h4>
                  <p class="text-gray-400 text-sm mb-3">{{ service.description }}</p>
                  
                  {% if service.duration %}
                    <div class="flex items-center gap-2 text-gray-400 text-sm mb-3">
                      <span>‚è±Ô∏è</span>
                      <span>Duration: {{ service.duration }}</span>
                    </div>
                  {% endif %}
                  
                  <div class="flex items-center justify-between">
                    <span class="text-primary text-2xl font-bold">‚Çπ{{ service.price }}</span>
                    <span class="bg-green-500/20 text-green-300 px-3 py-1 rounded-full text-sm">
                      {{ service.get_service_type_display }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Pricing Breakdown -->
            <div class="bg-slate-800/30 p-4 rounded-lg">
              <div class="flex justify-between items-center mb-2">
                <span class="text-gray-400">Service Amount</span>
                <span class="text-white">‚Çπ{{ service.price }}</span>
              </div>
              <div class="flex justify-between items-center mb-2">
                <span class="text-gray-400">Payment Gateway Fee</span>
                <span class="text-green-400">‚Çπ0 (Free)</span>
              </div>
              <hr class="border-gray-700 my-3">
              <div class="flex justify-between items-center text-lg font-bold">
                <span class="text-white">Total Amount</span>
                <span class="text-primary">‚Çπ{{ service.price }}</span>
              </div>
            </div>
            
            <!-- Security Notice -->
            <div class="bg-blue-900/20 border border-blue-500/30 p-4 rounded-lg">
              <div class="flex items-start gap-3">
                <span class="text-blue-400 text-lg">üîí</span>
                <div>
                  <p class="text-blue-300 font-semibold mb-1">Secure Payment</p>
                  <p class="text-gray-400 text-sm">
                    Your payment information is encrypted and processed securely by Razorpay
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Customer Details Form -->
        <div class="glass p-8 rounded-2xl subtle-glow">
          <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
            <span>üë§</span> Your Details
          </h2>

          <form method="post" class="space-y-6">
            {% csrf_token %}
            
            {% if form.non_field_errors %}
              <div class="bg-red-500/20 border border-red-500/50 text-red-300 p-4 rounded-lg flex items-start gap-3">
                <span class="text-xl">‚ö†Ô∏è</span>
                <div>
                  {% for error in form.non_field_errors %}
                    <p>{{ error }}</p>
                  {% endfor %}
                </div>
              </div>
            {% endif %}

            <!-- Service Selection (Hidden) -->
            <input type="hidden" name="service" value="{{ service.id }}">

            <!-- Customer Name -->
            <div>
              <label for="{{ form.customer_name.id_for_label }}" class="block text-sm font-semibold mb-2 text-light">
                {{ form.customer_name.label }} <span class="text-red-400">*</span>
              </label>
              {{ form.customer_name }}
              {% if form.customer_name.errors %}
                <span class="text-red-400 text-sm mt-1 flex items-center gap-1">
                  <span>‚ùå</span> {{ form.customer_name.errors.0 }}
                </span>
              {% endif %}
            </div>

            <!-- Customer Email -->
            <div>
              <label for="{{ form.customer_email.id_for_label }}" class="block text-sm font-semibold mb-2 text-light">
                {{ form.customer_email.label }} <span class="text-red-400">*</span>
              </label>
              {{ form.customer_email }}
              {% if form.customer_email.errors %}
                <span class="text-red-400 text-sm mt-1 flex items-center gap-1">
                  <span>‚ùå</span> {{ form.customer_email.errors.0 }}
                </span>
              {% endif %}
              <p class="text-gray-400 text-xs mt-1">We'll send order confirmation to this email</p>
            </div>

            <!-- Customer Phone -->
            <div>
              <label for="{{ form.customer_phone.id_for_label }}" class="block text-sm font-semibold mb-2 text-light">
                {{ form.customer_phone.label }}
              </label>
              {{ form.customer_phone }}
              {% if form.customer_phone.errors %}
                <span class="text-red-400 text-sm mt-1 flex items-center gap-1">
                  <span>‚ùå</span> {{ form.customer_phone.errors.0 }}
                </span>
              {% endif %}
              <p class="text-gray-400 text-xs mt-1">For order updates (optional)</p>
            </div>

            <!-- Additional Notes -->
            <div>
              <label for="{{ form.description.id_for_label }}" class="block text-sm font-semibold mb-2 text-light">
                {{ form.description.label }}
              </label>
              {{ form.description }}
              {% if form.description.errors %}
                <span class="text-red-400 text-sm mt-1 flex items-center gap-1">
                  <span>‚ùå</span> {{ form.description.errors.0 }}
                </span>
              {% endif %}
            </div>

            <!-- Terms Agreement -->
            <div class="bg-gray-800/30 p-4 rounded-lg">
              <label class="flex items-start gap-3 cursor-pointer">
                <input type="checkbox" required class="mt-1 text-primary bg-dark border-gray-600 rounded focus:ring-primary">
                <span class="text-sm text-gray-300">
                  I agree to the <a href="{% url 'portfolio:terms' %}" target="_blank" class="text-primary hover:underline">Terms and Conditions</a> and 
                  <a href="{% url 'portfolio:privacy' %}" target="_blank" class="text-primary hover:underline">Privacy Policy</a>
                </span>
              </label>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn-primary w-full justify-center text-lg">
              <span>ÔøΩ</span> Proceed to Razorpay Payment
            </button>

            <!-- Back Link -->
            <div class="text-center">
              <a href="{% url 'portfolio:services' %}" class="text-gray-400 hover:text-primary text-sm flex items-center justify-center gap-1">
                <span>‚Üê</span> Back to Services
              </a>
            </div>
          </form>
        </div>
        
      </div>

      <!-- Additional Information -->
      <div class="mt-12 grid md:grid-cols-3 gap-6">
        <div class="bg-green-900/20 border border-green-500/30 p-6 rounded-xl text-center">
          <div class="text-3xl mb-3">üîÑ</div>
          <h4 class="font-semibold mb-2 text-green-400">Easy Refunds</h4>
          <p class="text-gray-400 text-sm">
            Cancel within 24 hours with minimal processing fees
          </p>
        </div>
        
        <div class="bg-blue-900/20 border border-blue-500/30 p-6 rounded-xl text-center">
          <div class="text-3xl mb-3">üìû</div>
          <h4 class="font-semibold mb-2 text-blue-400">24/7 Support</h4>
          <p class="text-gray-400 text-sm">
            Get help anytime via email or phone support
          </p>
        </div>
        
        <div class="bg-purple-900/20 border border-purple-500/30 p-6 rounded-xl text-center">
          <div class="text-3xl mb-3">üìß</div>
          <h4 class="font-semibold mb-2 text-purple-400">Instant Confirmation</h4>
          <p class="text-gray-400 text-sm">
            Receive order confirmation immediately after payment
          </p>
        </div>
      </div>

    </div>
  </div>
</section>
{% endblock %}